# 프로세스와 쓰레드

---

## 프로세스

프로세스는 각각 독립된 메모리 공간을 가지며, 한 프로세스의 메모리 영역을 다른 프로세스가 직접 접근하는 것은 일반적으로 불가능하다.

- 프로세스는 실행 중인 프로그램의 인스턴스
- 운영체제로부터 자원을 할당 받아서 실행
- 각 프로세스는 독립된 메모리 영역을 갖는다.
  - 프로세스간 통신을 위해 별도의 Inter-Process Communication(IPC) 가 필요

### 메모리 구성요소

- Code: 프로그램 코드와 전역 변수를 저장합니다.
- Stack: 함수 호출 정보, 지역 변수 등을 저장합니다.
- Heap: 동적으로 할당된 메모리를 저장합니다.
- Data: 초기화된 정적 변수를 저장합니다.

## 쓰레드

- 프로세스의 작업 단위
- 쓰레드는 프로세스 내에서 실행되는 여러 실행 흐름
- 각 쓰레드는 자신만의 스택 영역을 갖는다.
- 힙 영역은 프로세스 내의 다른 쓰레드와 공유한다.
  - 같은 프로세스에 속한 쓰레드들은 데이터를 공유하기 쉽다.
  - 데이터의 일관성을 유지하는 것이 중요하다.

운영체제가 프로그램을 실행시키면 해당 프로그램을 실행할 수 있는 프로세스를 생성합니다. 이때, 프로세스는 자신만의 주소 공간, 자원, 실행 흐름을 갖게 됩니다.

프로세스 내에서 쓰레드를 생성하고 관리하는 것은 프로그램 코드와 프로세스 자체가 담당합니다. 프로세스는 자신만의 쓰레드를 생성하거나 다른 쓰레드를 추가로 생성할 수 있습니다. 즉, 쓰레드를 관리하는 것은 프로세스입니다.

프로세스 내의 쓰레드는 서로 공유하는 자원과 주소 공간을 갖습니다. 따라서 프로세스 내에서 생성된 쓰레드들은 해당 프로세스의 자원을 공유하며, 이를 통해 쓰레드간의 상호작용이 가능해집니다. 그러나 쓰레드 간의 동기화와 같은 작업은 프로그래머가 직접 구현해야 하며, 이를 통해 쓰레드들이 안전하게 자원에 접근하고 작업할 수 있습니다.

1. 운영체제가 JVM을 실행
2. JVM은 프로세스를 생성한다.
   - 이때 프로세스의 작업 공간은 프로그램이 필요로 하는 만큼 할당 받는다.
   - 프로그램간 즉, 프로세스간 자원은 독립적이다.
3. 해당 JVM 프로세스 안에서 작업을 수행하며 이 단위가 쓰레드이다.
   - JVM 프로세스 안의 쓰레드들은 자원을 공유한다.

## CPU의 코어와 쓰레드

---

### 코어

- 코어는 CPU의 처리 유닛입니다.
- CPU 내부에는 하나 이상의 코어가 존재하며, 각 코어는 독립적으로 명령어를 실행할 수 있다.
- 멀티코어 CPU는 코어 수에 비례하여 더 많은 작업을 동시에 처리할 수 있다.

### 쓰레드

- CPU에서의 쓰레드(또는 하드웨어 쓰레드)는 코어가 동시에 처리할 수 있는 작업 단위이다.
- 대부분의 모던 CPU는 각 코어가 한 번에 하나의 쓰레드를 처리할 수 있도록 설계되었다.
- CPU가 하이퍼스레딩기술을 지원하는 경우 두개 이상의 논리적인 쓰레드를 갖는다.

_CPU의 물리적 쓰레드가 한개라면 Thread Safe 하게 코드를 작성해야 할까?_

1코어 1물리적 쓰레드를 가진 CPU에서 Spring Framework를 실행 시켰을 경우

- 쓰레드가 동시에 접근하여 발생할만한 문제는 발생하지 않는다.
  - Thread Safe 하지 않는 Singleton Pattern
  - Transaction Dead Lock, Race Condition 등
- 하지만 쓰레드 간에 동기화를 유지하거나, 공유 자원을 안전하게 접근할 수 있도록 보호해야한다.

### OS 프로세스와 쓰레드 vs CPU 코어와 쓰레드

- 운영체제에서의 프로세스와 쓰레드는 CPU의 코어와 쓰레드와 연결
- 운영체제는 CPU의 코어를 효율적으로 활용하기 위해 프로세스와 쓰레드를 스케줄링한다.\
  즉, 어떤 프로세스의 어떤 쓰레드가 어느 코어에서 언제 실행될지를 결정한다.

> OS에서 쓰레드는 프로세스의 작업단위이다.
> CPU에서 쓰레드는 코어의 작업단위이다.

프로세스와 쓰레드는 각각 독립된 실행 흐름을 나타내므로, 하나의 프로세스나 쓰레드가 블록되거나 대기 상태에 있을 때도 다른 프로세스나 쓰레드가 CPU에서 실행될 수 있습니다. 이를 통해 전체 시스템의 응답성과
처리량을 높일 수 있습니다.

### Context Switching

- CPU의 쓰레드가 OS의 쓰레드를 병렬로 처리하기 위해 작업을 전환하는 것을 말한다.
- CPU의 쓰레드가 OS의 쓰레드를 전환하는 과정을 context switching이라고 한다.
- Context switching은 CPU의 쓰레드가 OS의 프로세스나 스레드의 context(상태 정보)를 저장하고 불러오는 비용이 발생한다.
- Context switching이 과도하게 발생하면, CPU 사용률이 낮아지고 성능 저하를 초래할 수 있다.
